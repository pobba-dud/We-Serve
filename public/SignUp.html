<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up</title>
  <link rel="stylesheet" href="SignUpStyle.css">
</head>

<body>
  <h1>Create an Account</h1>
  <div class="container">
    <form id="signupForm" method="POST" action="/registerJS" autocomplete="on">
      <div class="form-group">
        <label for="fname">First name:</label>
        <input type="text" id="fname" name="firstname" autocomplete="given-name" required>
      </div>
      <div class="form-group">
        <label for="lname">Last name:</label>
        <input type="text" id="lname" name="lastname" autocomplete="family-name" required>
      </div>
      <div class="form-group">
        <label for="gender">Gender:</label>
        <select name="gender" id="gender" autocomplete="sex" required>
          <option value="default">(Default)</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
          <option value="preferNotToSay">Prefer Not to Say</option>
        </select>
      </div>
      <div class="form-group">
        <label for="birthday">Birthday:</label>
        <input type="date" id="birthday" name="birthday" autocomplete="bday" required>
      </div>
      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" autocomplete="email" required>
      </div>
      <div class="form-group">
        <label for="phonenumber">Phone number (optional):</label>
        <input type="tel" id="phonenumber" name="phonenumber" placeholder="xxx-xxx-xxxx" pattern="[0-9]{3}[0-9]{3}[0-9]{4}" autocomplete="tel">
      </div>
      <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" autocomplete="new-password" required>
      </div>
      <div class="form-group">
        <label for="confirmPassword">Confirm Password:</label>
        <input type="password" id="confirmPassword" autocomplete="new-password" required>
      </div>
      <div class="form-group">
        <label for="isorg">Are you registering as an organization?</label>
        <select name="isorg" id="isorg" autocomplete="off" required>
          <option value="false">No</option>
          <option value="true">Yes</option>
        </select>
      </div>
      <button type="submit">Sign Up</button>
    </form>
  </div>

  <script>
    document.getElementById('signupForm').addEventListener('submit', async function (event) {
  event.preventDefault(); // Prevent form submission

  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirmPassword').value;

  if (password !== confirmPassword) {
    alert("Passwords do not match!");
    return; // Stop form submission
  }

  const formData = new FormData(this);
  const data = Object.fromEntries(formData.entries());

  try {
    const response = await fetch('/registerJS', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });

    const result = await response.json();
    console.log('Response:', response); // Log response object
    console.log('Result:', result); // Log result body

    if (response.ok) {
      // Success: Redirect to login page
      alert('User registered successfully! Redirecting to login...');
      window.location.href = '/login';
    } else {
      // Error: Show alert
      alert(result.message || 'Error registering user.');
    }
  } catch (error) {
    // If any error occurs in the fetch process
    console.error('Fetch error:', error);
    alert('A network error occurred.');
  }
});


  </script>
</body>

</html>
