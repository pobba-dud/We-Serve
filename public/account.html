<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Profile</title>
  <link rel="icon" type="image/x-icon" href="Images/favicon.ico">
  <script src="script.js"></script>
  <style>

html {
  height: 100%;
  width: 100%;

}
nav a {
  font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif
}
/* start of css for navbar */
#NavUl {
  list-style-type: none;
  margin: 0%;
  padding: 0%;
  overflow: hidden;
  background-color: #283A43;
  font-size: 20px;
}
li {
  float: left;
  display: flex;
  align-content: center;
  color: #9bd1e5;
}
li a:link, li a:visited{
  padding-top: 18px;
  padding-bottom: 18px;
  padding-right: 18px;
  padding-left: 18px;
  text-align: center;
  text-decoration: none;
  color: #9bd1e5;
  border-width: 1px;
  border-color: none;
  border-radius: 5px;
  display: inline-block;
}
li a:hover{
  padding-top: 18px;
  padding-bottom: 18px;
  padding-right: 18px;
  padding-left: 18px;
  text-align: center;
  text-decoration: none;
  color: #9bd1e5;
  background-color: rgb(57, 94, 112);
  border-width: 1px;
  border-color: none;
  border-radius: 5px;
  display: inline-block;
}
  #NavUl img{
  float: left;
   display: flex;
    width: 57px;
    height:auto;
   margin: 0%;
   padding: 0%;
   margin-right: 5px;
 }

/* end of navbar css */

body {
    background-color: #e8f5ff;
    font-family: Arial;
    overflow: hidden;
}

/* dark mode */
body.dark-mode {
  background-color: #121212; /* Dark background */
  color: #f7f7f7; /* Light text color */
}

body.dark-mode h2 {
    color: white;
}


body.dark-mode .sidenav {
    background-color: #3f3e3e;
    color: white;
}

body.dark-mode .active {
    background-color: #6e6e6e;
    color: white;
}

body.dark-mode .active:hover {
    background-color: #868686;
    color: white;
}

body.dark-mode .url a:hover {
    background-color: #868686;
    color: white;
}

body.dark-mode .card {
background-color: #3f3e3e;  
} 

body.dark-mode table {
  background-color: #3f3e3e; /* Dark table background */
  color: #f7f7f7; /* Light text color */
  border: #070707;
}

body.dark-mode .innerContainer {
  background-color: #3f3e3e;
}

body.dark-mode .highlight {
  background-color: #535353;
}

body.dark-mode .schedule-btn {
  background-color: #3f3e3e;
}

body.dark-mode .schedule-btn:hover {
  background-color: #535353;
}


/* NavbarTop */
.navbar-top {
    background-color: #fff;
    color: #333;
    box-shadow: 0px 4px 8px 0px grey;
    height: 70px;
}

.title {
    font-family: 'Dancing Script', cursive;
    padding-top: 15px;
    position: absolute;
    left: 45%;
}

.navbar-top ul {
    float: right;
    list-style-type: none;
    margin: 0;
    overflow: hidden;
    padding: 18px 50px 0 40px;
}

.navbar-top ul li {
    float: left;
}

.navbar-top ul li a {
    color: #333;
    padding: 14px 16px;
    text-align: center;
    text-decoration: none;
}

.icon-count {
    background-color: #ff0000;
    color: #fff;
    float: right;
    font-size: 11px;
    left: -25px;
    padding: 2px;
    position: relative;
}

/* End */

/* Sidenav */
.sidenav {
    background-color: #fff;
    color: #333;
    border-bottom-right-radius: 25px;
    border-top-right-radius: 25px;
    height: 86%;
    left: 0;
    overflow-x: hidden;
    padding-top: 20px;
    position: absolute;
    top: 10%;
    width: 25%;
}

.profile {
    margin-bottom: 20px;
    margin-top: -12px;
    text-align: center;
}

.profile img {
    border-radius: 50%;
    box-shadow: 0px 0px 5px 1px grey;

}

.name {
    font-size: 20px;
    font-weight: bold;
    padding-top: 20px;
}

.job {
    font-size: 16px;
    font-weight: bold;
    padding-top: 10px;
}

.url, hr {
    text-align: center;
}

.url hr {
    margin-left: 20%;
    width: 60%;
}

.url a {
  background-color: #e8f5ff;
    border-radius: 28px;
    color: #000;
    font-size: 20px;
    margin: 10px 0px;
    padding: 6px 8px;
    width: 70%;
}


/* Basic link styling */
.hoverable-link {
  display: inline-block;
  text-decoration: none;
  color: #000; /* Default text color */
  font-size: 18px; /* Adjust as needed */
  padding: 10px 15px;
  border-radius: 5px;
  transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
}
button {
  color: #818181;
    display: block;
    font-size: 20px;
    margin: 10px 0;
    padding: 6px 8px;
    text-decoration: none;
}
/* Hover effect for links */
.hoverable-link:hover {
  background-color: #e8f5ff; /* Light blue background */
  color: #0056b3; /* Darker text color for contrast */
  transform: scale(1.05); /* Slightly enlarges the link */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Adds a subtle shadow */
/* Optional focus state for accessibility */
}
.hoverable-link:focus {
  outline: none;
  box-shadow: 0 0 4px 2px rgba(0, 123, 255, 0.5); /* Adds a glowing effect */
}

/* Basic button hover effects */
.hoverable-button {
  display: inline-block;
  text-decoration: none;
  color: #000; /* Default text color */
  font-size: 18px; /* Adjust as needed */
  padding: 10px 15px;
  border-radius: 5px;
  transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
}


.hoverable-button:hover {
  background-color: #e8f5ff; /* Light blue background */
  color: #0056b3; /* Darker text color for contrast */
  transform: scale(1.05); /* Slightly enlarges the link */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Adds a subtle shadow */
}


.hoverable-button:focus {
  outline: none;
  box-shadow: 0 0 4px 2px rgba(0, 123, 255, 0.5); /* Adds a glowing effect */
}




/* End */

/* Main */
.main {
    margin-top: 2%;
    margin-left: 29%;
    font-size: 28px;
    width: 65%;
}

.main h2 {
    color: #333;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 24px;
    margin-bottom: 10px;
}

.main .card {
    background-color: #9bd1e5;
    border-radius: 18px;
    box-shadow: 1px 1px 8px 0 grey;
    height: auto;
    margin-bottom: 20px;
    padding: 20px 0 20px 50px;
}

.main .card table {
    border: none;
    font-size: 16px;
    height: 270px;
    width: 80%;
}

.edit {
    position: absolute;
    color: #e7e7e8;
    right: 14%;

    
}
@media only screen and (max-width: 700px) {
#AllignLogin{display: flex;flex-direction: column;}
.sidenav{position:relative;width: auto; border-radius: 0%;}
html { font-size: smaller; }
.nav ul { align-items: center; }
.main{margin: auto; width: auto;}
.main h2{margin-left: 10%}
html{overflow:scroll;}
}
/* Modal styling */
.modal {
  display: none; 
  position: fixed; 
  z-index: 1000; 
  left: 0; 
  top: 0; 
  width: 100%; 
  height: 100%; 
  overflow: auto; 
  background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
  background-color: #fff;
  margin: 10% auto;
  padding: 20px;
  border-radius: 10px;
  width: 50%;
}
.modal-content.dark-mode {
  background-color: #414141;
}
.modal-content h2 {
  margin-left: 20%;
}

 /* Style for the input box */
 input[type="text"] {
      width: 75%; /* Adjust the width as needed */
      padding: 10px;
      font-size: 1rem;
      border: 2px solid #ccc;
      border-radius: 5px;
      outline: none;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* Change the border color and shadow on focus */
    input[type="text"]:focus {
      border-color: #007BFF;
      box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
    }

    /* Add spacing between the input and the next line */
    input[type="text"] + br {
      margin-bottom: 10px;
    }

    input[type="email"] {
      width: 75%; /* Adjust the width as needed */
      padding: 10px;
      font-size: 1rem;
      border: 2px solid #ccc;
      border-radius: 5px;
      outline: none;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* Change the border color and shadow on focus */
    input[type="email"]:focus {
      border-color: #007BFF;
      box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
    }

    /* Add spacing between the input and the next line */
    input[type="email"] + br {
      margin-bottom: 10px;
    }

    input[type="tel"] {
      width: 75%; /* Adjust the width as needed */
      padding: 10px;
      font-size: 1rem;
      border: 2px solid #ccc;
      border-radius: 5px;
      outline: none;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* Change the border color and shadow on focus */
    input[type="tel"]:focus {
      border-color: #007BFF;
      box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
    }

    /* Add spacing between the input and the next line */
    input[type="tel"] + br {
      margin-bottom: 10px;
    }

    select {
      width: 75%; /* Adjust the width as needed */
      padding: 10px;
      font-size: 1rem;
      border: 2px solid #ccc;
      border-radius: 5px;
      outline: none;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* Change the border color and shadow on focus */
    select:focus {
      border-color: #007BFF;
      box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
    }

    /* Add spacing between the input and the next line */
    select + br {
      margin-bottom: 10px;
    }

    button[type="submit"] {
      background-color: rgb(57, 94, 112);
      color: white;
      box-shadow: #000;
    }


.close-btn {
  float: right;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
}

.close-btn:hover {
  color: red;
}



/* End */
  </style>
</head>   
  

<body style="margin: 0%;">

    <div class="notification" id="customNotification" style="display: none; background-color: #283A43; color: white; padding: 10px; position: fixed; bottom: 20px; right: 20px; border-radius: 5px;">
        This is a notification message!
        <button onclick="closeNotification()" style="background-color: #283A43; color: white; border: none; margin-left: 10px;">X</button>
    </div>
    
    <script>
      // Function to show custom notification
      function showNotification(message) {
          const notification = document.getElementById("customNotification");
          console.log(notification);
          notification.textContent = message; // Set the message
          notification.style.display = "block"; // Show the notification
          console.log(notification.textContent);
          // Hide the notification after 5 seconds
          setTimeout(() => {
            console.log("timer Function started");
              notification.style.opacity = '0'; // Fade out
              setTimeout(() => {
                  notification.style.display = "none"; // Hide after fade out
                  notification.style.opacity = '1'; // Reset opacity for next use
              }, 500); // Wait for the fade out duration
          }, 500000); // Display for 5 seconds
      }
    
      // Function to check for events within 36 hours and show notifications
      function closeNotification() {
        const notification = document.getElementById("customNotification");
        notification.style.display = "none"; // Hide the notification
    }
  // Function to fetch and display user data on the account page
  function fetchUserData() {
    fetch('/profileJS', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
    })
    .then(response => {
      if (response.ok) {
        return response.json(); // Parse the JSON response
      } else {
        throw new Error('User not authenticated or profile data not found');
      }
    })
    .then(data => {
      // Assuming 'data' is the object containing user data returned from the /profile endpoint
      document.getElementById('name').textContent = `${data.firstname} ${data.lastname}`;
document.getElementById('name2').textContent = `${data.firstname} ${data.lastname}`;
document.getElementById('email').textContent = data.email;
document.getElementById('phonenumber').textContent = data.phonenumber || 'Not provided';
document.getElementById('gender').textContent = data.gender || 'Not specified';

console.log("Birthday from data:", data.birthday);

const date = new Date(data.birthday);

// Check if the date is valid
if (isNaN(date)) {
  console.error("Invalid date:", data.birthday);
} else {
  // Extract UTC components
  const year = date.getUTCFullYear();
  const month = date.getUTCMonth(); // Month is zero-based (0 = January)
  const day = date.getUTCDate();

  // Format the date as YYYY-MM-DD, ensuring zero-padded month and day
  const formattedDate = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
  document.getElementById('birthday').textContent = formattedDate || 'Not provided';
}
//you can show a fallback message or handle the error as needed
    });
  }

  // Call the function to fetch and display user data when the page loads
  

      // Call checkUpcomingEvents function at the start or at interval
    </script>
    
<!-- navbar -->
<nav>
  <ul id="NavUl" style="padding-bottom: 0px;">
    <a href="index"><img src="Images/logo.png"></a>
    <li><a href="dashboard" style="padding-bottom: 20px; padding-top: 19px;"><b>Homepage</b></a></li>
    <li><a href="discover" style="padding-bottom: 20px; padding-top: 19px;"><b>Discover</b></a></li>
    <li><a href="hours" style="padding-bottom: 20px; padding-top: 19px;"><b>Hour log</b></a></li>
    <li><a href="calendar" style="padding-bottom: 19px; padding-top: 19px;"><b>Calendar</b></a></li>
    <li style="float:right; display:flex; align-content: center;"><a href="account"> <img src="Images/Default_pfp.png" alt="Profile" style="width:auto;height:23px;"> </a></li>
  </ul>
</nav>

    <!--End of navbar -->


<div id="AllignLogin">

    <!-- Sidenav -->
    <div class="sidenav">
      <div class="profile">
          <img src= 'Images/Default_pfp.png' style="width:70%;height:auto;margin-top: 100px;">

          <div class = name id="name2">
              
          </div>
      </div>

      <div class="sidenav-url">
        <div class="url">
          <a href="#" class="hoverable-link" id="openModal">Edit</a>
          <hr style="align-items: center;">
        </div>
        <div class="url">
          <a href="settings" class="hoverable-link">Settings</a>
          <hr style="align-items: center;">
        </div>
      </div>
          <div class="url">
            <form action="/logout" method="POST">
              <button 
                id="Logout" 
                class="hoverable-button"
                style="background-color: #e8f5ff;
                       border-radius: 28px;
                       color: #000;
                       font-size: 20px;
                       margin: 10px 0px;
                       padding: 6px 8px;
                       width: 70%;"
                type="submit">
                Logout
              </button>
            </form>
          </div>
          
      </div>
  </div>
  <!-- End -->
   <!-- Modal Structure -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Edit Account</h2>
    <P>Only change the info you want to change, leave the rest blank</P>
    <form id="updateForm">
      <label for="name" style="padding-right: 1%;">Name:</label>
      <input type="text" id="editName" name="firstname" placeholder="Enter your name"><br>
      <div style="padding: 1%;"></div>
      <label for="name">Last Name:</label>
      <input type="text" id="editLast" name="lastname" placeholder="Enter your last name"><br>
      <div style="padding: 1%;"></div>
      <label for="email">Email:</label>
      <input type="email" id="editEmail" name="email" placeholder="Enter your email"><br>
      <div style="padding: 1%;"></div>
      <label for="gender">Gender:</label>
      <select id="editGender" name="gender">
        <option value="">Select your gender</option><br>
        <option value="male">Male</option>
        <option value="female">Female</option>
        <option value="other">Other</option>
        <option value="prefer_not_to_say">Prefer not to say</option>
      </select>
      <br>
      <div style="padding: 1%;"></div>
      <label for="phonenumber">Phone Number:</label>
      <input type="tel" id="editPhoneNumber" name="phonenumber" placeholder="Enter your phone number"><br>
      <div style="padding: 1%;"></div>
      <button type="submit">Save Changes</button>
    </form>    
  </div>
</div>

<!-- Main -->
<div class="main">
  <h2>IDENTITY</h2>
  <div class="card">
      <div class="card-body">
          <i class="fa fa-pen fa-xs edit"></i>
          <table>
              <tbody>
                  <tr>
                      <td>Name</td>
                      <td>:</td>
                      <td id="name"></td>
                  </tr>
                  <tr>
                      <td>Email</td>
                      <td>:</td>
                      <td id = "email"></td>
                  </tr>
                  <tr>
                    <td>Phone Number</td>
                    <td>:</td>
                    <td id="phonenumber"></td>
                </tr>
                  <tr>
                      <td>Gender</td>
                      <td>:</td>
                      <td id ="gender"></td>
                  </tr>
                  <tr>
                      <td>Birthday</td>
                      <td>:</td>
                      <td id = birthday></td>
                  </tr>
                  <tr>
                      <td>Skills</td>
                      <td>:</td>
                      <td></td>
                  </tr>
              </tbody>
          </table>
      </div>
  </div>
</div>
<!-- End -->
<script>
  // Modal controls
  const editModal = document.getElementById("editModal");
  const closeModalBtn = document.querySelector(".close-btn");
  const editBtn = document.querySelector(".edit");
  
  // Open modal on edit button click
  editBtn.addEventListener("click", () => {
    // Populate modal with current user data
    document.getElementById("editName").value = document.getElementById("name").textContent;
    document.getElementById("editLast").value = document.getElementById("last").textContent;
    document.getElementById("editEmail").value = document.getElementById("email").textContent;
    document.getElementById("editGender").value = document.getElementById("gender").textContent.toLowerCase();
    
  
    editModal.style.display = "block";
  });
  
  // Close modal
  closeModalBtn.addEventListener("click", () => {
    editModal.style.display = "none";
  });
  
  // Close modal when clicking outside the modal
  window.addEventListener("click", (e) => {
    if (e.target === editModal) {
      editModal.style.display = "none";
    }
  });
  
  // Handle form submission
  document.getElementById("updateForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  // Capture the updated values
  const updatedName = document.getElementById("editName").value || null;
  const updatedLast= document.getElementById("editLast").value || null;
  const updatedEmail = document.getElementById("editEmail").value || null;
  const updatedGender = document.getElementById("editGender").value || null;
  const updatedPhoneNumber = document.getElementById("editPhoneNumber").value || null;

  try {
    const response = await fetch("/updateProfile", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        name: updatedName,
        last: updatedLast,
        email: updatedEmail,
        gender: updatedGender,
        phonenumber: updatedPhoneNumber,
      }),
    });

    if (response.ok) {
      const data = await response.json();
      alert(data.message);
      location.reload(); // Reload the page to reflect updates
    } else {
      const errorData = await response.json();
      alert(`Error updating profile: ${errorData.message}`);
    }
  } catch (error) {
    console.error("Error:", error);
    alert("An unexpected error occurred.");
  }
});


  document.addEventListener("DOMContentLoaded", function () {
  const openModalButton = document.getElementById("openModal");
  const modal = document.getElementById("editModal");
  const closeButton = modal.querySelector(".close-btn");

  // Open the modal
  openModalButton.addEventListener("click", function (event) {
    event.preventDefault(); // Prevent the default link behavior
    modal.style.display = "block";
  });

  // Close the modal
  closeButton.addEventListener("click", function () {
    modal.style.display = "none";
  });

  // Close the modal when clicking outside the modal content
  window.addEventListener("click", function (event) {
    if (event.target === modal) {
      modal.style.display = "none";
    }
  });
});

    function setTheme(theme) {
        document.body.className = theme === 'dark' ? 'dark-mode' : '';
        localStorage.setItem('theme', theme); // Save the theme preference
    }

    // Load the theme from local storage when the page loads
    window.onload = function() {
        fetchUserData();
        checkUpcomingEvents();
        const savedTheme = localStorage.getItem('theme') || 'light'; // Default to light
        setTheme(savedTheme);
        document.getElementById('theme').value = savedTheme; // Set the select box to the saved theme
    };

    // Add event listener for form submission
    document.getElementById('settings-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the default form submission
        // Here you can add any code to save settings if needed
        window.location.href = 'account'; // Redirect to the login page
    });
    
</script>


</body>
    </html>